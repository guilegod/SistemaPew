<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Scanner de QR - Sistema Bundy</title>
    <link rel="stylesheet" href="./style.css" />
    <link rel="stylesheet" href="./style/scanner.css" />
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
  </head>

  <body>
    <!-- BOTÃƒO FIXO MENU -->
    <button id="toggleMenu" class="toggle-btn">
      <span class="bar"></span>
      <span class="bar"></span>
      <span class="bar"></span>
    </button>

    <!-- SIDEBAR -->
    <aside class="sidebar" id="sidebar">
      <div class="logo-area">
        <img src="./assets/logo.png" alt="Logo Bundy" class="logo" />
        <h2 class="logo-text">Bundy System</h2>
      </div>
      <nav class="menu">
        <ul>
          <li><a href="index.html">ğŸ  InÃ­cio</a></li>
          <li><a href="estoqueCompleto.html">ğŸ“¦ Estoque</a></li>
          <li><a href="cadastroMaterial.html">ğŸ§¾ Cadastro</a></li>
          <li><a href="cordenacao.html">ğŸ“Š CoordenaÃ§Ã£o</a></li>
          <li><a href="scanner.html" class="active">ğŸ“· Scanner QR</a></li>
        </ul>
      </nav>
    </aside>

    <!-- CONTEÃšDO -->
    <main class="content">
      <h1>ğŸ“· Leitor de QR Code</h1>
      <p>Posicione a cÃ¢mera sobre o cÃ³digo da bobina para abrir seus detalhes.</p>

      <div id="qr-reader" class="scanner-box"></div>
      <div id="qr-reader-results"></div>
    </main>

    <!-- Scripts -->
    <script src="./script/menu.js"></script>
    <script>
      // Configura o scanner
      function onScanSuccess(decodedText) {
        document.getElementById("qr-reader-results").innerHTML =
          `<p>âœ… QR Lido: ${decodedText}</p>`;
        if (decodedText.includes("bobina.html")) {
          window.location.href = decodedText;
        } else {
          alert("QR invÃ¡lido! Este cÃ³digo nÃ£o pertence a uma bobina.");
        }
      }

      function onScanFailure(error) {
        console.warn(`Erro ao ler: ${error}`);
      }

      const html5QrCode = new Html5Qrcode("qr-reader");
      html5QrCode
        .start(
          { facingMode: "environment" },
          {
            fps: 10,
            qrbox: 250,
          },
          onScanSuccess,
          onScanFailure
        )
        .catch((err) => {
          console.error("Erro ao iniciar cÃ¢mera:", err);
          alert("âŒ Erro ao acessar a cÃ¢mera. Verifique as permissÃµes!");
        });
    </script>
  </body>
</html>
