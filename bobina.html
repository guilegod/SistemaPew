<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bobina - Detalhes</title>
  <link rel="stylesheet" href="./style.css" />
  <style>
    body {
      background:#0a192f;
      color:#fff;
      font-family:sans-serif;
      padding:20px;
      display:flex;
      justify-content:center;
      align-items:center;
      min-height:100vh;
    }
    .container {
      background:#142c44;
      border-radius:12px;
      padding:25px;
      width:90%;
      max-width:520px;
      box-shadow:0 0 15px rgba(0,0,0,0.3);
    }
    h1 {
      text-align:center;
      color:#5fa8d3;
      margin-bottom:20px;
    }
    ul {
      list-style:none;
      padding:0;
      margin:0;
    }
    li {
      margin-bottom:10px;
      border-bottom:1px solid rgba(255,255,255,0.1);
      padding-bottom:8px;
    }
    img {
      display:block;
      margin:20px auto;
      border-radius:10px;
      border:2px solid #5fa8d3;
    }
    .buttons {
      display:flex;
      justify-content:space-between;
      margin-top:20px;
    }
    button {
      background:#2563eb;
      border:none;
      color:#fff;
      padding:10px 14px;
      border-radius:8px;
      cursor:pointer;
      flex:1;
      margin:0 5px;
      transition:0.2s;
    }
    button:hover {
      filter:brightness(1.15);
    }
    .loading {
      text-align:center;
      font-size:18px;
      color:#a3c9f1;
    }
    .error {
      text-align:center;
      color:#ff6b6b;
      font-weight:bold;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üì¶ Detalhes da Bobina</h1>
    <div id="conteudo" class="loading">Carregando dados...</div>
  </div>

  <script>
    // üîó IP fixo do backend FastAPI (use o IP local do seu PC)
    const API_URL = "http://192.168.18.3:8000/bobinas";

    async function carregarBobina() {
      const params = new URLSearchParams(window.location.search);
      const rastro = params.get("rastro");
      const conteudo = document.getElementById("conteudo");

      if (!rastro) {
        conteudo.innerHTML = "<p class='error'>‚ùå Nenhum rastro informado na URL.</p>";
        return;
      }

      try {
        const res = await fetch(API_URL);
        if (!res.ok) throw new Error("Falha ao conectar com o servidor.");
        const todas = await res.json();
        const bobina = todas.find(b => b.rastro === rastro);

        if (!bobina) {
          conteudo.innerHTML = `<p class='error'>‚ùå Bobina ${rastro} n√£o encontrada.</p>`;
          return;
        }

        conteudo.innerHTML = `
          <ul>
            <li><b>Rastro:</b> ${bobina.rastro}</li>
            <li><b>Data:</b> ${bobina.data}</li>
            <li><b>Operador:</b> ${bobina.operador}</li>
            <li><b>Linha:</b> ${bobina.linha}</li>
            <li><b>Status:</b> ${bobina.status}</li>
            <li><b>Tipo:</b> ${bobina.tipo}</li>
            <li><b>Di√¢metro:</b> ${bobina.diametro}</li>
            <li><b>Furos:</b> ${bobina.furos}</li>
            <li><b>Peso:</b> ${bobina.peso} kg</li>
            <li><b>Comprimento:</b> ${bobina.comprimento} mm</li>
            <li><b>Turno:</b> ${bobina.turno}</li>
          </ul>
          ${
            bobina.qrCode
              ? `<img src="${bobina.qrCode}" width="200" alt="QR Code">`
              : ""
          }
          <div class="buttons">
            <button onclick="window.history.back()">‚¨ÖÔ∏è Voltar</button>
            <button onclick="window.print()">üñ®Ô∏è Imprimir</button>
          </div>
        `;
      } catch (err) {
        conteudo.innerHTML = `<p class='error'>‚ö†Ô∏è Erro ao carregar: ${err.message}</p>`;
      }
    }

    carregarBobina();
  </script>
</body>
</html>
